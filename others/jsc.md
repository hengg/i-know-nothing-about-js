## javascript 是一门解释型动态脚本语言

- 解释型
- 动态语言
- 脚本语言

我们一个个来看：

首先，主流编程语言有解释型（如 JavaScript）、编译型（如 C++）和半解释半编译（如 Java）这几大类型。

因为机器只能直接读取二进制数据，所以我们的代码（高级语言）要经过编译器编译为机器语言（汇编）后才能由机器执行。汇编实际上是助记符，是二进制指令的映射。

举例来说:

```javascript
let a = 1;
let b = 1;
let sum = a + b ;
```

转成汇编可能是：

```
DEFINE sum
DEFINE a
a PUSH 1
DEFINE b
b PUSH 1
sum ADD a
sum ADD b
```

而根据CPU的不同，对应的二进制指令集可能有所不同。即使 CPU 相同，可执行文件中还包括操作系统 API、内存、线程、进程等系统资源，不同的操作系统其实现也不尽相同、其可执行文件格式也不相同。还有一种情况比如代码中大量调用 Windows 提供的系统级 API，即使机器指令相同，代码也不能直接运行在 Linux 上；同样，IO 多路复用虽然是个很成熟的模式，但 Windows 和 Linux 其实现也各不相同，Linux是 epoll,windows则是 IOCP。所以编译型语言如果想跨平台执行，就需要针对不同平台各自编译。

而 Java 为什么能跨平台？是因为 Java 在编译阶段生成的并不是最终的机器码，而是class字节码，一种中间形态的文件。同时 Java 针对不同平台提供不同的 JVM（Java 虚拟机），由 JVM 负责解释执行 class 字节码。这也就是所谓的半解释、半编译。有一本书叫做《一个64位操作系统的设计与实现》，如果我们根据这本书写了一个简单的操作系统，那么可想而知，号称跨平台的 Java 很有可能无法支持我们这个操作系统，因为没有对应的 JVM。

JavaScript 则是典型的解释执行的语言。但实际上呢，它也需要编译成机器码才能执行。只不过它不需要提前编译成可执行文件而已。这部分工作通常由宿主环境（浏览器、Node.js）包办了。它的编译过程和编译型语言大同小异：

- 词法分析生成词法单元 比如`let i = 1; `这个语句中就包含 5 个词法单元
- 语法分析生成 ast （抽象语法树）
- AST 转化为目标代码

当然程序一般都会由多个部分（模块）组成 ，比如C++中一个简单的输出就要引入标准库的 iostream：

```c++
#include <iostream>
using namespace std;
int main()
{
    cout << "Happy Hacking!\n";
    return 0;
}
```

编译器单单生成目标代码是不够的，他还需要把多份目标代码（库）链接起来才能生成可执行文件。

为什么提起性能，我们总有个根深蒂固的印象就是 C/C++ 性能比 JavaScript 好呢？那是因为编译型语言在编译阶段有大量的时间去专门做优化的工作，而 JavaScript 在执行前那短短的时间里根本来不及做太多的优化，所以 JavaScript 会给人一种性能孱弱的印象。早期的 JavaScript 也确实是这样。

JavaScript 又是一门动态类型的语言，变量的类型只有在运行时才能确定，所以它的性能没有静态类型的语言强。因为静态类型的语言其类型在编译之前就能确定，自然优化的空间就比较大。

不过得益于 V8 引擎（相比其它的JavaScript的引擎转换成字节码或解释执行，Nodejs会用 V8 提供的 JS2C 工具将 JavaScript 转译为 C++代码），JavaScript 和其他语言性能上的差距已经不足为道了，

那么什么是动态语言呢，它是一类在运行时可以改变其结构的语言：例如新的函数、对象、甚至代码可以被引进。很明显 JavaScript 是一门动态语言。那么 Objective-C是动态语言么？它也可以在运行时修改对象，但它不能动态创建类，没有 eval。

为什么 ReactNative 能够热更新？也是基于动态语言的特性

那么 TypeScript 是什么类型的语言呢？它有静态类型检查，它是静态语言吗？实际上它只是 JavaScript 的一个方言。TypeScript 最终还是要转译为 JavaScript 才能执行（tsc），就如同我们使用babel 把 ES6 代码转译为 ES5 一样。这个过程严格上来说不是编译。TypeScript 最大的优势就是静态类型检查和类型推断，这是 JavaScript 严重缺失的能力。但实际上如果你忽略IDE 给的各种报错提示强行运行 TS 代码，也还是有几率能够成功跑起来的。

刚刚我们提到报错，不妨再扩展说一说错误

通常来说错误分为以下几种：

- 编译时错误
- 链接时错误
- 运行时错误

是不是和编译过程能够严格对应起来？

编译时错误分为：

- 语法错误

  ```javascript
  var str ='s ;
  ```

  这就是典型的语法错误，这种代码无法生成AST。通常我们这么写代码，IDE 就会给报错。然而我们并没有进行编译，为什么会在写代码的时候IDE 就给报错了呢？这当然是 IDE 的优化，在使用 VSCode 的时候，如果你写了一段以上错误的代码，其实 IDE 不是立即报错了，它会扫描分析代码后才给提示，当然这个速度很快，几乎无感知。

- 类型错误

  这就是 TS 的强项了。编译器会检查我们声明的变量和函数的类型，JavaScript中我们非常熟悉的`Type Error:undefined is not object`,这也是类型检查。VSCode 对于TypeScript类型检查就没有语法检查那么迅捷了，经常会出现我们改了一个报错，过一阵子才生效。这就是编译期类型检查



链接时错误：在链接阶段发生的异常。这个 JavaScript 中比较少见，在编译型语言中比较常见。

运行时错误：这是最难排查的错误了，举例来说：

```c++
int divider(int a,int b){
	return a/b;
}
```

上面的代码编译、链接，都没问题。但是一旦如此使用`divider(1,0)`就会报错了，这就是典型的运行时错误。通常来说运行时错误都是程序不够健壮导致的



最后让我们来看看 JavaScript 中最常见的几种错误：

7 个 TypeError，1个 ReferenceError：

![v2-06dca3e38036a279671832ac12408a46_r](v2-06dca3e38036a279671832ac12408a46_r.jpg)

显然这 8 种问题，我们都能用 TypeScript 来消灭它
