<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="utf-8">
  <title>传感器编辑</title>
</head>

<body>
  <section id="svg">
  </section>
  <section id="svg_edit">
    <form name="selectSvgForm" id="selectSvgForm" method="post" enctype="multipart/form-data" action="javascript: uploadSvg();">
      <p>上传SVG: <input type="file" name="file" /></p>
      <p><input type="submit" value="上传" /></p>
    </form>
    <button onclick="saveSvg()">保存</button>
  </section>
  <script type="text/javascript">
    function uploadSvg() {
      var form = document.forms["selectSvgForm"];
      if (form["file"].files.length > 0) {
        // 寻找表单域中的 <input type="file" ... /> 标签
        var file = form["file"].files[0];
        // try sending
        var reader = new FileReader();

        reader.onload = function (event) {
          var contents = event.target.result;
          document.getElementById("svg").innerHTML = contents;
        };

        reader.onerror = function (event) {
          console.error("File could not be read! Code " + event.target.error.code);
        };

        reader.readAsText(file);
      } else {
        alert("Please choose a file.");
      }
    }

    function saveSvg() {
      var fileName = prompt("请输入图片名", "");
      var data = document.getElementById("svg").innerHTML;
      var name = fileName + ".svg";

      var urlObject = window.URL || window.webkitURL || window;
      var exportBlob = new Blob([data]);
      var saveLink = document.createElementNS("http://www.w3.org/1999/xhtml", "a")
      saveLink.href = urlObject.createObjectURL(exportBlob);
      saveLink.download = name;

      var ev = document.createEvent("MouseEvents");
      ev.initMouseEvent(
        "click", true, false, window, 0, 0, 0, 0, 0
        , false, false, false, false, 0, null
      );
      saveLink.dispatchEvent(ev);
    }

    function sensorsClick(evt) {
      console.log(evt.target.id);
      var sensorId = prompt("请输入传感器编号", "");
      console.log(sensorId);
      evt.target.setAttributeNS(null, "sensorid", sensorId);
    }
  </script>
</body>

</html>